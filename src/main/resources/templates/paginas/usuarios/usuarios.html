<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="pt-BR">

<head>
	<meta charset="UTF-8" />
	<title>Usuarios</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" />

	<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.7.1/css/bootstrap-datepicker.min.css"
		rel="stylesheet" />

	<!-- Popper JS -->

	<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/dt-1.10.20/datatables.min.css" />
	<link rel="stylesheet" href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.min.css" />
	<link rel="stylesheet" href="https://cdn.datatables.net/buttons/1.6.1/css/buttons.dataTables.min.css" />
	<link rel="stylesheet"
		href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css" />
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css"
		integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous" />
	<style>
		.form-group {
			flex: 1 0 auto;
		}

		.body {
			background-color: white;
		}
	</style>
	<script datatype="text/javascript" >
	   var teste;
		function inativarOuAtivarUsuario(obj,valor1,valor2){
		  var coluna1 = $(obj).parents("tr").find("td:nth-child(" + valor1 + ")");
		  var coluna2 = $(obj).parents("tr").find("td:nth-child(" + valor2 + ")");
		 // window.alert("Valor "+coluna.html());
		  teste= $(obj).parents("tr").find("td:nth-child(" + valor1 + ")");

          $('#XXA').html(coluna1.html()+' - '+coluna2.html() )
          $('#XXB').html(coluna1.html()+' - '+coluna2.html() )
		  }
         //Confirma a inativacao
		 function confirmarInativacao(){
           var id=teste.html();
           window.location.href="/usuarios/inativarativar/"+id+"/"+"inativar";

		 }
		 //Confimra a ativacao
		 function confirmarAtivacao(){
           var id=teste.html();
           window.location.href="/usuarios/inativarativar/"+id+"/"+"ativar";

		 }

	</script>
</head>

<body>

	<div class="card-header bg-dark">
		<h5 style="color:white;">Lista de Usuários</h5>
	</div>
	<div class="card-body">

		<a sec:authorize="hasRole('ADMIN')" class="btn btn-primary" th:href="@{/usuarios/cadastro}">Cadastrar</a>
		<a class="btn btn-success" th:href="@{/menu}">Sair</a> <br />
		<br />
		<h4>LISTAGEM</h4>
		<div class="table-responsive">

				<table id="tb3" class="table table-bordered table-condensed table-striped table-hover" style="font-size: 12px">
					<thead class="thead-dark">
						<tr>
							<th>ID</th>
							<th>NOME</th>
							<th>LOGIN</th>
							<th>EMAIL</th>
							<th>TIPO</th>
							<th>STATUS</th>
							<th sec:authorize="hasRole('ADMIN')">ALTERAR</th>
							<th sec:authorize="hasRole('ADMIN')">INATIVAR</th>
							<th sec:authorize="hasRole('ADMIN')">ATIVAR</th>
						</tr>
					</thead>
					<tbody>
					
						<tr th:each="co,ta : ${usuario}">
							<td  id="id"  th:text="${co.idusuario}">1</td>
							<td id="nome" th:text="${co.nomecompleto}">2</td>
							<td th:text="${co.login}"></td>
							<td th:text="${co.emailprincipal}"></td>
							<td th:text="${co.toTipo()}"></td>
							<td th:text="${co.toAtivo()}"></td>

							<td  sec:authorize="hasRole('ADMIN')" class="text-center">
								<a type="submit" th:href="@{'/usuarios/alterar/'+${co.idusuario}}"
									class="btn btn-primary  btn-sm button"><i class="far fa-edit"></i></a>
							</td>
							<td  sec:authorize="hasRole('ADMIN')" class="text-center">
								<button  th:disabled="${co.toAtivo()=='Inativo'}"  type="submit" data-toggle="modal" data-target="#myModal2"  onclick="inativarOuAtivarUsuario(this,1,2)"
										class="btn btn-danger btn-sm">
									<i class="far fa-thumbs-down"></i></button>

							</td>
							<td  sec:authorize="hasRole('ADMIN')" class="text-center">
								<button  th:disabled="${co.toAtivo()=='Ativo'}"  type="submit" data-toggle="modal" data-target="#myModal3"  onclick="inativarOuAtivarUsuario(this,1,2)"
										class="btn btn-success btn-sm">
									<i class="far fa-thumbs-up"></i></button>

							</td>
						</tr>
					</tbody>
				</table>

		</div>
	</div>

	<!--Mostra o modal da inativacao-->
	<div class="modal fade" id="myModal1">
		<div class="modal-dialog modal-dialog-centered">
			<!-- Modal content-->
			<div class="modal-content">
				<div class="modal-header">
					<h4 class="modal-title" style="font-size: 20px">Alterar Usuário</h4>
					<button type="button" class="close" data-dismiss="modal">
						&times;
					</button>
				</div>
				<div class="modal-body">
					<p>Some text in the modal.</p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-success" onclick="confirmaInativacao();" >Sim</button>
					<button type="button" class="btn btn-primary" data-dismiss="modal">
						Não
					</button>
				</div>
			</div>
		</div>
	</div>

	
	<!--Mostra o modal da ativacao-->
	<div class="modal fade" id="myModal2" role="dialog">
		<div class="modal-dialog modal-dialog-centered" role="document">
			<!-- Modal content-->
			<div class="modal-content">
				<div class="modal-header">
					<h4 class="modal-title">Inativar o Usuário</h4>
					<button type="submit"  class="close" data-dismiss="modal">x</button>

				</div>
				<div class="modal-body">
					<p>Realmente deseja inativar o usuário?</p>
					<h5 id="XXA"></h5>

				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-success" data-dismiss="modal" onclick="confirmarInativacao();" >Sim</button>
					<button type="button" class="btn btn-primary" data-dismiss="modal">
						Não
					</button>
				</div>
			</div>
		</div>
	</div>

	<div class="modal fade" id="myModal3" role="dialog">
		<div class="modal-dialog modal-dialog-centered" role="document">
			<!-- Modal content-->
			<div class="modal-content">
				<div class="modal-header">
					<h4 class="modal-title">Ativar o Usuário</h4>
					<button type="submit"  class="close" data-dismiss="modal">x</button>

				</div>
				<div class="modal-body">
					<p>Realmente Ativar o Usuário?.</p>
					<h5 id="XXB"></h5>

				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-success" data-dismiss="modal" onclick="confirmarAtivacao();" >Sim</button>
					<button type="button" class="btn btn-primary" data-dismiss="modal">
						Não
					</button>
				</div>
			</div>
		</div>
	</div>

</body>

<!-- Popper JS -->
<script type="text/javascript" th:src="@{/webjars/jquery/3.4.1/jquery.min.js}"></script>
<script type="text/javascript" th:src="@{/webjars/bootstrap/4.4.1/js/bootstrap.min.js}"></script>
<script type="text/javascript" th:src="@{/js/libfuncoes.js}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
<!-- Latest compiled JavaScript -->
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
<script src="https://cdn.datatables.net/v/dt/dt-1.10.20/datatables.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/plug-ins/1.10.20/i18n/Portuguese-Brasil.json"></script>
<script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.6.1/js/dataTables.buttons.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
<script src="https://cdn.datatables.net/buttons/1.6.1/js/buttons.html5.min.js"></script>

<script type="text/javascript">
	$(document).ready(function () {
		$("#tb3").DataTable({
			dom: "Bfrtip",
			buttons: ["copyHtml5", "excelHtml5", "csvHtml5", "pdfHtml5"],
			language: {

				url: "//cdn.datatables.net/plug-ins/1.10.20/i18n/Portuguese-Brasil.json",
			},
		});
	});

	function apagaForm() {
		document.getElementById("form1").reset();
	}
	$(function () {
		$("#datainicial").datepicker({
			dateFormat: "dd/mm/yy",
		});
	});
	$(function () {
		$("#datafinal").datepicker({
			dateFormat: "dd/mm/yy",
		});
	});

	jQuery(function ($) {
		$.datepicker.regional["pt-BR"] = {
			showOn: "button",
			buttonImage: "images/calendar.png",
			buttonImageOnly: true,
			dateFormat: "dd/mm/yy",
			dayNames: [
				"Domingo",
				"Segunda",
				"Terça",
				"Quarta",
				"Quinta",
				"Sexta",
				"Sábado",
			],
			dayNamesMin: ["D", "S", "T", "Q", "Q", "S", "S", "D"],
			dayNamesShort: ["Dom", "Seg", "Ter", "Qua", "Qui", "Sex", "Sáb", "Dom"],
			monthNames: [
				"Janeiro",
				"Fevereiro",
				"Março",
				"Abril",
				"Maio",
				"Junho",
				"Julho",
				"Agosto",
				"Setembro",
				"Outubro",
				"Novembro",
				"Dezembro",
			],
			monthNamesShort: [
				"Jan",
				"Fev",
				"Mar",
				"Abr",
				"Mai",
				"Jun",
				"Jul",
				"Ago",
				"Set",
				"Out",
				"Nov",
				"Dez",
			],
			nextText: "Próximo",
			prevText: "Anterior",
			yearSuffix: "",
		};
		$.datepicker.setDefaults($.datepicker.regional["pt-BR"]);
	});
</script>

</html>